#!/bin/bash
set -e

# build web
cd src/web

echo $'\n> pwd\n'
pwd
echo $'\n> npm install\n'
npm install
echo $'\n> npm run build\n'
npm run build

# remove old build, but keep .gitkeep
rm -rf ../slskd/wwwroot
mkdir ../slskd/wwwroot
touch ../slskd/wwwroot/.gitkeep

# copy new files
echo $'\n> cp -r build/* ../slskd/wwwroot/\n'
cp -r build/* ../slskd/wwwroot/

# publish api + web
cd ../slskd
echo $'\n> pwd\n'
pwd
echo $'\n> dotnet build --configuration Release\n'

dotnet build --configuration Release

echo $'\nbuild succeded.'